<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Premnath Engineering - Smart Calculation Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @keyframes slideIn {
      from { transform: translateX(120%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .key-notification {
      position: fixed;
      top: 80px;
      right: 20px;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      animation: slideIn 0.4s ease-out;
      z-index: 1000;
      max-width: 350px;
    }
    
    .gradient-bg {
      background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #4facfe);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
    }
    
    .tool-card {
      transition: all 0.3s ease;
      animation: fadeInUp 0.6s ease-out;
    }
    
    .tool-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    }
    
    .stat-badge {
      animation: pulse 2s infinite;
    }
    
    .hero-icon {
      animation: float 3s ease-in-out infinite;
    }
    
    .usage-badge {
      position: absolute;
      top: -10px;
      right: -10px;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
  </style>
  <script>
    // --- SECURITY & AUTH LOGIC ---
    
    // Initialize usage tracking
    function initUsageTracking() {
      if (!localStorage.getItem('toolUsage')) {
        localStorage.setItem('toolUsage', JSON.stringify({}));
      }
    }

    // Track tool usage
    function trackToolUsage(toolName) {
      const usage = JSON.parse(localStorage.getItem('toolUsage') || '{}');
      usage[toolName] = (usage[toolName] || 0) + 1;
      localStorage.setItem('toolUsage', JSON.stringify(usage));
      
      // Send to backend for admin analytics
      const token = localStorage.getItem('access_token');
      if (token) {
        fetch('/api/track-usage', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ tool: toolName, timestamp: new Date().toISOString() })
        }).catch(err => console.log('Tracking error:', err));
      }
    }

    // Get tool usage count
    function getToolUsage(toolName) {
      const usage = JSON.parse(localStorage.getItem('toolUsage') || '{}');
      return usage[toolName] || 0;
    }

    // Update usage badges
    function updateUsageBadges() {
      document.querySelectorAll('[data-tool]').forEach(card => {
        const toolName = card.getAttribute('data-tool');
        const count = getToolUsage(toolName);
        if (count > 0) {
          const badge = card.querySelector('.usage-badge');
          if (badge) badge.textContent = count;
        }
      });
    }

    // 1. Page Load hone par check karein ki User kon hai
    document.addEventListener("DOMContentLoaded", function() {
      initUsageTracking();
      updateUsageBadges();
      
      const token = localStorage.getItem("access_token");
      const username = localStorage.getItem("username");
      const hasKey = localStorage.getItem("has_key") === "true";
      const activationKey = localStorage.getItem("activation_key");
      const isAdmin = localStorage.getItem("is_admin") === "true";
      const authSection = document.getElementById("auth-section");

      if (token) {
        // Show key notification if user has key
        if (hasKey && activationKey) {
          showKeyNotification(activationKey);
        }

        // Agar User Logged In hai to ye dikhayein
        authSection.innerHTML = `
          <div class="flex items-center gap-3">
            <span class="text-blue-200 text-sm hidden md:inline font-medium flex items-center gap-2">
              <i class="fas fa-user-circle"></i> ${username || 'Engineer'}
            </span>
            
            ${hasKey 
              ? '<span class="bg-green-600 text-white text-xs px-3 py-2 rounded-lg shadow flex items-center gap-1"><i class="fas fa-check-circle"></i> Key Active</span>' 
              : '<span class="bg-yellow-500 text-white text-xs px-3 py-2 rounded-lg shadow flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> No Key</span>'}

            <a href="/profile" class="bg-white/20 hover:bg-white/30 text-white text-xs px-3 py-2 rounded-lg shadow transition flex items-center gap-1"><i class="fas fa-user"></i> Profile</a>
            ${isAdmin 
              ? '<a href="/admin" class="bg-purple-600 hover:bg-purple-700 text-white text-xs px-3 py-2 rounded-lg shadow-lg hover:shadow-xl transition flex items-center gap-1"><i class="fas fa-crown"></i> Admin</a>' 
              : ''}

            <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white text-xs px-3 py-2 rounded-lg shadow transition flex items-center gap-1">
              <i class="fas fa-sign-out-alt"></i> Logout
            </button>
          </div>
        `;
      } else {
        // Agar User Logged Out hai to ye dikhayein
        authSection.innerHTML = `
          <div class="flex items-center gap-3">
            <a href="/login" class="text-white hover:text-blue-200 font-medium transition">Log In</a>
            <a href="/signup" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded shadow transition font-bold">Sign Up</a>
          </div>
        `;
      }
    });

    function showKeyNotification(key) {
      const notification = document.createElement('div');
      notification.className = 'key-notification';
      notification.innerHTML = `
        <div class="font-bold text-lg mb-2">üéâ Congratulations!</div>
        <div class="text-sm mb-2">You have an activation key:</div>
        <div class="bg-white bg-opacity-20 px-3 py-2 rounded font-mono text-sm">${key}</div>
      `;
      document.body.appendChild(notification);

      // Auto remove after 8 seconds
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(120%)';
        setTimeout(() => notification.remove(), 500);
      }, 8000);
    }

    // 2. Logout Function
    async function logout() {
      if(confirm("Are you sure you want to logout?")) {
        try { await fetch('/logout', { method: 'POST' }); } catch(e) {}
        localStorage.clear(); 
        window.location.href = "/login";
      }
    }

    // 3. Tool Access Guard (Security Check)
    function checkAccess(event, url, toolName) {
      event.preventDefault(); // Direct open hone se roko
      
      const token = localStorage.getItem("access_token");
      const hasKey = localStorage.getItem("has_key") === "true";

      // Check 1: Login hai ya nahi?
      if (!token) {
        alert("‚ö†Ô∏è Access Denied!\n\nPlease Login to use Engineering Tools.");
        window.location.href = "/login";
        return;
      }
      
      // Check 2: Activation Key hai ya nahi?
      if (!hasKey) {
        alert("üîí Activation Key Required!\n\nYour account doesn't have an activation key.\nPlease contact admin to get one.");
        return;
      }
      
      // Track usage
      if (toolName) {
        trackToolUsage(toolName);
      }
      
      // Sab sahi hai to Tool kholo
      window.location.href = url;
    }
  </script>
</head>

<body class="bg-slate-50 flex flex-col min-h-screen">
  
  <nav class="bg-slate-900 text-white shadow-2xl sticky top-0 z-50">
    <div class="container mx-auto px-6 h-20 flex justify-between items-center">
        <a href="/" class="flex items-center gap-3 group">
            <div class="bg-white p-2 rounded-xl group-hover:scale-110 transition-all shadow-lg">
                <img src="/logo.png" alt="Logo" class="h-10 w-auto" />
            </div>
            <div>
              <span class="font-bold text-xl tracking-wide group-hover:text-blue-400 transition block">Premnath Engineering</span>
              <span class="text-xs text-gray-400">Smart Calculation Hub</span>
            </div>
        </a>

        <div id="auth-section"></div>
    </div>
  </nav>

  <div class="gradient-bg text-white py-20 shadow-2xl relative overflow-hidden">
      <div class="absolute inset-0 opacity-20">
        <div class="absolute top-10 left-10 w-72 h-72 bg-white rounded-full blur-3xl"></div>
        <div class="absolute bottom-10 right-10 w-96 h-96 bg-blue-300 rounded-full blur-3xl"></div>
      </div>
      <div class="container mx-auto px-4 text-center relative z-10">
          <div class="hero-icon mb-6">
            <i class="fas fa-calculator text-6xl mb-4 opacity-90"></i>
          </div>
          <h1 class="text-4xl md:text-6xl font-bold mb-6 leading-tight">
            Engineering Calculation Suite
          </h1>
          <p class="text-blue-100 text-lg md:text-xl max-w-3xl mx-auto mb-8 leading-relaxed">
            <i class="fas fa-rocket mr-2"></i>
            Advanced cloud-based tools for Railway Dynamics, Hydraulic Systems, and Safety Analysis
          </p>
          <div class="flex flex-wrap justify-center gap-4 text-sm">
            <span class="bg-white bg-opacity-20 px-4 py-2 rounded-full backdrop-blur-sm">
              <i class="fas fa-shield-alt mr-2"></i>Secure & Reliable
            </span>
            <span class="bg-white bg-opacity-20 px-4 py-2 rounded-full backdrop-blur-sm">
              <i class="fas fa-chart-line mr-2"></i>Real-time Calculations
            </span>
            <span class="bg-white bg-opacity-20 px-4 py-2 rounded-full backdrop-blur-sm">
              <i class="fas fa-cloud mr-2"></i>Cloud-Based
            </span>
          </div>
      </div>
  </div>

  <div class="container mx-auto px-4 py-12 flex-grow">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      
      <div class="bg-white rounded-xl shadow-md hover:shadow-2xl hover:-translate-y-1 transition duration-300 border-t-4 border-blue-600 flex flex-col">
        <div class="p-6 flex-grow">
          <div class="flex justify-between items-start mb-4">
            <h2 class="font-bold text-xl text-slate-800">Hydraulic Motor</h2>
            <span class="bg-blue-100 text-blue-800 text-[10px] px-2 py-1 rounded-full font-bold tracking-wider">CORE</span>
          </div>
          <p class="text-slate-600 text-sm leading-relaxed">Calculate pump displacement (cc), motor efficiency, and achievable vehicle speed parameters for hydraulic systems.</p>
        </div>
        <div class="px-6 pb-6 mt-auto">
            <button onclick="checkAccess(event, '/calculator')" class="w-full bg-slate-800 text-white py-3 rounded-lg hover:bg-blue-700 transition font-semibold shadow-md flex justify-center items-center gap-2">
                Launch Tool <span>‚Üí</span>
            </button>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-md hover:shadow-2xl hover:-translate-y-1 transition duration-300 border-t-4 border-purple-600 flex flex-col">
        <div class="p-6 flex-grow">
          <div class="flex justify-between items-start mb-4">
            <h2 class="font-bold text-xl text-slate-800">Qmax Safety</h2>
            <span class="bg-purple-100 text-purple-800 text-[10px] px-2 py-1 rounded-full font-bold tracking-wider">SAFETY</span>
          </div>
          <p class="text-slate-600 text-sm leading-relaxed">Vertical force analysis (Qmax) based on rail profile diameter and material strength to ensure derailment safety.</p>
        </div>
        <div class="px-6 pb-6 mt-auto">
            <button onclick="checkAccess(event, '/qmax')" class="w-full bg-slate-800 text-white py-3 rounded-lg hover:bg-purple-700 transition font-semibold shadow-md flex justify-center items-center gap-2">
                Launch Tool <span>‚Üí</span>
            </button>
        </div>
      </div>
      
      <div class="bg-white rounded-xl shadow-md hover:shadow-2xl hover:-translate-y-1 transition duration-300 border-t-4 border-orange-500 flex flex-col">
        <div class="p-6 flex-grow">
          <div class="flex justify-between items-start mb-4">
            <h2 class="font-bold text-xl text-slate-800">Load Distribution</h2>
            <span class="bg-orange-100 text-orange-800 text-[10px] px-2 py-1 rounded-full font-bold tracking-wider">ANALYSIS</span>
          </div>
          <p class="text-slate-600 text-sm leading-relaxed">Analyze wheel load balancing (Q1-Q4) and check safety limits (ŒîQ/Q) for Bogie and Axle configurations.</p>
        </div>
        <div class="px-6 pb-6 mt-auto">
            <button onclick="checkAccess(event, '/load_distribution')" class="w-full bg-slate-800 text-white py-3 rounded-lg hover:bg-orange-600 transition font-semibold shadow-md flex justify-center items-center gap-2">
                Launch Tool <span>‚Üí</span>
            </button>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-md hover:shadow-2xl hover:-translate-y-1 transition duration-300 border-t-4 border-green-600 flex flex-col">
        <div class="p-6 flex-grow">
          <div class="flex justify-between items-start mb-4">
            <h2 class="font-bold text-xl text-slate-800">Tractive Effort</h2>
            <span class="bg-green-100 text-green-800 text-[10px] px-2 py-1 rounded-full font-bold tracking-wider">POWER</span>
          </div>
          <p class="text-slate-600 text-sm leading-relaxed">Calculate required tractive effort, Rail Horsepower (RHP), and OHE current consumption for electric locos.</p>
        </div>
        <div class="px-6 pb-6 mt-auto">
            <button onclick="checkAccess(event, '/tractive_effort')" class="w-full bg-slate-800 text-white py-3 rounded-lg hover:bg-green-700 transition font-semibold shadow-md flex justify-center items-center gap-2">
                Launch Tool <span>‚Üí</span>
            </button>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-md hover:shadow-2xl hover:-translate-y-1 transition duration-300 border-t-4 border-red-600 flex flex-col">
        <div class="p-6 flex-grow">
          <div class="flex justify-between items-start mb-4">
            <h2 class="font-bold text-xl text-slate-800">Performance</h2>
            <span class="bg-red-100 text-red-800 text-[10px] px-2 py-1 rounded-full font-bold tracking-wider">GRAPHS</span>
          </div>
          <p class="text-slate-600 text-sm leading-relaxed">Complete vehicle analysis: Speed vs Slope tables, Shunting capability charts, and Torque curve visualization.</p>
        </div>
        <div class="px-6 pb-6 mt-auto">
            <button onclick="checkAccess(event, '/vehicle_performance')" class="w-full bg-slate-800 text-white py-3 rounded-lg hover:bg-red-700 transition font-semibold shadow-md flex justify-center items-center gap-2">
                Launch Tool <span>‚Üí</span>
            </button>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-md hover:shadow-2xl hover:-translate-y-1 transition duration-300 border-t-4 border-slate-700 flex flex-col">
        <div class="p-6 flex-grow">
          <div class="flex justify-between items-start mb-4">
            <h2 class="font-bold text-xl text-slate-800">Braking Analysis</h2>
            <span class="bg-slate-200 text-slate-800 text-[10px] px-2 py-1 rounded-full font-bold tracking-wider">SAFETY</span>
          </div>
          <p class="text-slate-600 text-sm leading-relaxed">Calculate stopping distances, parking brake forces, and verify compliance with EN 15746-2 standards.</p>
        </div>
        <div class="px-6 pb-6 mt-auto">
            <button onclick="checkAccess(event, '/braking_calculator')" class="w-full bg-slate-800 text-white py-3 rounded-lg hover:bg-slate-600 transition font-semibold shadow-md flex justify-center items-center gap-2">
                Launch Tool <span>‚Üí</span>
            </button>
        </div>
      </div>

    </div>
  </div>

  <footer class="bg-slate-900 text-gray-400 text-center py-6 border-t border-slate-800 mt-auto">
    <p class="text-sm font-medium">¬© 2025 Premnath Engineering Works. All rights reserved.</p>
    <p class="text-xs mt-2 text-gray-600">Authorized Personnel Only | R&D Division</p>
  </footer>

</body>
</html>