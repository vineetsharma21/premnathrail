<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Braking Performance Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .input-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 1.4em;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95em;
        }
        
        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #28a745;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3);
        }
        
        .btn-tertiary {
            background: #ff6b6b;
            color: white;
        }
        
        .btn-tertiary:hover {
            background: #ee5a52;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
        }
        
        .results-section {
            margin-top: 30px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .result-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .result-card h3 {
            font-size: 0.9em;
            margin-bottom: 10px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .result-card .value {
            font-size: 2em;
            font-weight: bold;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        th, td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 0.5px;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
        
        .compliance-pass {
            color: #28a745;
            font-weight: bold;
        }
        
        .compliance-fail {
            color: #dc3545;
            font-weight: bold;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #667eea;
        }
        
        .error {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        
        .info-box h4 {
            color: #1976d2;
            margin-bottom: 5px;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÜ Braking Performance Calculator</h1>
            <p>Based on DIN EN 15746-2:2021-05 Railway Standards</p>
        </div>
        
        <div class="content">
            <div class="info-box">
                <h4>üìã About This Calculator</h4>
                <p>Calculate braking distances, forces, and stopping distances for railway vehicles based on international standards.</p>
            </div>
            
            <div class="input-section">
                <h2 class="section-title">Vehicle Parameters</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="mass">Vehicle Mass (kg)</label>
                        <input type="number" id="mass" step="any" value="10000" placeholder="Enter mass in kg">
                    </div>
                    
                    <div class="form-group">
                        <label for="speed">Maximum Speed (km/h)</label>
                        <input type="number" id="speed" step="any" value="50" placeholder="Enter speed">
                    </div>
                    
                    <div class="form-group">
                        <label for="mu">Coefficient of Friction (Œº)</label>
                        <input type="number" id="mu" step="any" value="0.3" placeholder="Typical: 0.2-0.4">
                    </div>
                    
                    <div class="form-group">
                        <label for="reaction">Reaction Time (seconds)</label>
                        <input type="number" id="reaction" step="any" value="1.0" placeholder="Default: 1.0">
                    </div>
                    
                    <div class="form-group">
                        <label for="wheels">Number of Wheels</label>
                        <input type="number" id="wheels" value="4" placeholder="Total wheels">
                    </div>
                </div>
            </div>
            
            <div class="input-section">
                <h2 class="section-title">Track Parameters</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="gradient">Gradient Value</label>
                        <input type="number" id="gradient" step="any" value="0" placeholder="Enter gradient">
                    </div>
                    
                    <div class="form-group">
                        <label for="gradient_type">Gradient Type</label>
                        <select id="gradient_type">
                            <option value="percent">Percentage (%)</option>
                            <option value="1in">1 in N (ratio)</option>
                            <option value="degree">Degree (¬∞)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="speed_increment">Speed Increment (km/h)</label>
                        <input type="number" id="speed_increment" step="any" value="10" placeholder="For multi-speed analysis">
                    </div>
                    
                    <div class="form-group">
                        <label for="gradient_steps">Gradient Analysis Steps</label>
                        <input type="number" id="gradient_steps" value="5" placeholder="Number of gradient divisions">
                    </div>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" id="calc">
                    üßÆ Calculate Single Result
                </button>
                <button class="btn btn-primary" id="calcMultiSpeed">
                    üìä Multi-Speed Analysis
                </button>
                <button class="btn btn-primary" id="calcMultiGradient">
                    üìà Multi-Gradient Analysis
                </button>
                <button class="btn btn-secondary" id="pdf">
                    üìÑ Download PDF Report
                </button>
                <button class="btn btn-tertiary" id="clearResults">
                    üóëÔ∏è Clear Results
                </button>
            </div>
            
            <div id="result"></div>
        </div>
    </div>

    <script>
        // Helper function to get input values
        function getInputValues() {
            return {
                mass_kg: parseFloat(document.getElementById('mass').value),
                speed_kmh: parseFloat(document.getElementById('speed').value),
                mu: parseFloat(document.getElementById('mu').value),
                reaction_time: parseFloat(document.getElementById('reaction').value),
                gradient: parseFloat(document.getElementById('gradient').value),
                gradient_type: document.getElementById('gradient_type').value,
                num_wheels: parseInt(document.getElementById('wheels').value, 10),
                speed_increment: parseFloat(document.getElementById('speed_increment').value),
                gradient_steps: parseInt(document.getElementById('gradient_steps').value, 10)
            };
        }

        // Single calculation
        document.getElementById('calc').addEventListener('click', async function() {
            const payload = getInputValues();
            const resEl = document.getElementById('result');
            resEl.innerHTML = '<div class="loading">‚è≥ Calculating...</div>';

            try {
                const resp = await fetch('/braking_calculate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                
                if (!resp.ok) throw new Error(await resp.text());
                const data = await resp.json();
                
                displaySingleResult(data.result);
            } catch (err) {
                resEl.innerHTML = `<div class="error">‚ùå Error: ${err.message}</div>`;
            }
        });

        // Multi-speed analysis
        document.getElementById('calcMultiSpeed').addEventListener('click', async function() {
            const payload = getInputValues();
            const resEl = document.getElementById('result');
            resEl.innerHTML = '<div class="loading">‚è≥ Analyzing multiple speeds...</div>';

            try {
                const resp = await fetch('/braking_multi_speed', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                
                if (!resp.ok) throw new Error(await resp.text());
                const data = await resp.json();
                
                displayMultiResults(data.results, 'Multi-Speed Analysis');
            } catch (err) {
                resEl.innerHTML = `<div class="error">‚ùå Error: ${err.message}</div>`;
            }
        });

        // Multi-gradient analysis
        document.getElementById('calcMultiGradient').addEventListener('click', async function() {
            const payload = getInputValues();
            const resEl = document.getElementById('result');
            resEl.innerHTML = '<div class="loading">‚è≥ Analyzing multiple gradients...</div>';

            try {
                const resp = await fetch('/braking_multi_gradient', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                
                if (!resp.ok) throw new Error(await resp.text());
                const data = await resp.json();
                
                displayMultiResults(data.results, 'Multi-Gradient Analysis');
            } catch (err) {
                resEl.innerHTML = `<div class="error">‚ùå Error: ${err.message}</div>`;
            }
        });

        // PDF download
        document.getElementById('pdf').addEventListener('click', async function() {
            const payload = getInputValues();
            const resEl = document.getElementById('result');
            
            try {
                const resp = await fetch('/download_braking_report', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                
                if (!resp.ok) throw new Error(await resp.text());
                
                const blob = await resp.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'Braking_Performance_Report.pdf';
                document.body.appendChild(a);
                a.click();
                a.remove();
                window.URL.revokeObjectURL(url);
                
                alert('‚úÖ PDF report downloaded successfully!');
            } catch (err) {
                alert(`‚ùå Error: ${err.message}`);
            }
        });

        // Clear results
        document.getElementById('clearResults').addEventListener('click', function() {
            document.getElementById('result').innerHTML = '';
        });

        // Display single result
        function displaySingleResult(d) {
            const complianceClass = d.standard_compliance.includes('‚úì') ? 'compliance-pass' : 'compliance-fail';
            
            let html = `
                <div class="results-section">
                    <h2 class="section-title">üìä Calculation Results</h2>
                    <div class="results-grid">
                        <div class="result-card">
                            <h3>Speed</h3>
                            <div class="value">${d.speed_kmh} km/h</div>
                            <small>${d.speed_ms} m/s</small>
                        </div>
                        <div class="result-card">
                            <h3>Braking Distance</h3>
                            <div class="value">${d.braking_distance_m} m</div>
                        </div>
                        <div class="result-card">
                            <h3>Total Stop Distance</h3>
                            <div class="value">${d.total_stopping_distance_m} m</div>
                        </div>
                        <div class="result-card">
                            <h3>Deceleration</h3>
                            <div class="value">${d.deceleration_m_s2} m/s¬≤</div>
                        </div>
                        <div class="result-card">
                            <h3>Braking Force</h3>
                            <div class="value">${d.max_braking_force_n} N</div>
                        </div>
                        <div class="result-card">
                            <h3>Force per Wheel</h3>
                            <div class="value">${d.braking_force_per_wheel_n} N</div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>Reaction Distance</td><td>${d.reaction_distance_m} m</td></tr>
                                <tr><td>Gravitational Force</td><td>${d.gravitational_force_n} N</td></tr>
                                <tr><td>Net Force</td><td>${d.net_force_n} N</td></tr>
                                <tr><td>Gradient Angle</td><td>${d.angle_deg}¬∞</td></tr>
                                <tr><td>Standard Compliance</td><td class="${complianceClass}">${d.standard_compliance}</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            document.getElementById('result').innerHTML = html;
        }

        // Display multiple results
        function displayMultiResults(results, title) {
            let html = `
                <div class="results-section">
                    <h2 class="section-title">üìä ${title}</h2>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Speed (km/h)</th>
                                    <th>Speed (m/s)</th>
                                    <th>Reaction Dist (m)</th>
                                    <th>Braking Dist (m)</th>
                                    <th>Total Stop (m)</th>
                                    <th>Decel (m/s¬≤)</th>
                                    <th>Braking Force (N)</th>
                                    <th>Compliance</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            results.forEach(r => {
                const complianceClass = r.standard_compliance.includes('‚úì') ? 'compliance-pass' : 'compliance-fail';
                html += `
                    <tr>
                        <td>${r.speed_kmh}</td>
                        <td>${r.speed_ms}</td>
                        <td>${r.reaction_distance_m}</td>
                        <td>${r.braking_distance_m}</td>
                        <td>${r.total_stopping_distance_m}</td>
                        <td>${r.deceleration_m_s2}</td>
                        <td>${r.max_braking_force_n}</td>
                        <td class="${complianceClass}">${r.standard_compliance}</td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            document.getElementById('result').innerHTML = html;
        }
    </script>
</body>
</html>
